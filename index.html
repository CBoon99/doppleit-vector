<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:">
    <title>Doppleit Vector</title>
    <style>
        :root {
            --primary-color: #e37800;
            --glow-color: #ffb340;
            --gradient: linear-gradient(90deg, #e37800, #ffb340);
            --shadow-glow: 0 0 10px rgba(255, 191, 64, 0.4);
        }
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, #1a1a1a 0%, #2a2a40 100%);
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        #app {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        #header {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.08);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        #header h1 {
            font-size: 24px;
            font-weight: 700;
            margin: 0;
            text-shadow: var(--shadow-glow);
        }
        #status {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        #status::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #00ff00;
            border-radius: 50%;
            margin-right: 6px;
        }
        #toolbar {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            align-items: center;
        }
        .tool-btn, .export-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            background: var(--gradient);
            color: #fff;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .tool-btn:hover, .export-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-glow);
        }
        .tool-btn:active, .export-btn:active {
            transform: translateY(1px);
            box-shadow: none;
        }
        .tool-btn.active {
            background: #ffb340;
            box-shadow: var(--shadow-glow);
        }
        .tool-btn svg, .export-btn svg {
            width: 18px;
            height: 18px;
            fill: #fff;
        }
        .tool-btn:hover svg, .export-btn:hover svg {
            fill: #fff;
        }
        .divider {
            width: 1px;
            background: rgba(255, 255, 255, 0.2);
            align-self: stretch;
            margin: 0 8px;
        }
        #colorPicker {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
        }
        #colorCanvas {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            cursor: crosshair;
            clip-path: circle(40px at center);
            aspect-ratio: 1 / 1;
        }
        #lightnessSlider {
            width: 20px;
            height: 80px;
            border-radius: 4px;
            cursor: pointer;
        }
        #colorInputs {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        #colorInputs input {
            padding: 4px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 12px;
            width: 100px;
        }
        #swatches {
            display: flex;
            gap: 4px;
            margin-top: 8px;
        }
        .swatch {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .swatch:hover {
            transform: scale(1.1);
        }
        #toolOptions {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }
        #toolOptions h4 {
            margin: 0;
            font-size: 13px;
            font-weight: 600;
        }
        #toolOptions label {
            font-size: 12px;
            margin-right: 4px;
        }
        #toolOptions input, #toolOptions select {
            padding: 4px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 12px;
        }
        #exportOptions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        #filenameInput {
            padding: 4px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 12px;
            width: 150px;
        }
        #canvasContainer {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            overflow: auto;
        }
        #canvas {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        #footer {
            padding: 10px;
            background: rgba(255, 255, 255, 0.08);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            text-align: center;
            font-size: 12px;
            color: #cccccc;
        }
        #footer a {
            color: var(--glow-color);
            text-decoration: none;
            margin: 0 10px;
        }
        #footer a:hover {
            text-decoration: underline;
        }
        .tooltip {
            position: relative;
        }
        .tooltip::after {
            content: attr(title);
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease-in-out;
            backdrop-filter: blur(10px);
        }
        .tooltip:hover::after {
            opacity: 1;
        }
        @media (min-width: 1024px) {
            #colorPicker {
                flex-direction: column;
                align-items: flex-start;
            }
            #colorInputs, #swatches {
                flex-direction: column;
                align-items: flex-start;
            }
        }
        @media (max-width: 768px) {
            #header, #toolbar, #canvasContainer {
                padding: 12px;
            }
            #header h1 {
                font-size: 20px;
            }
            #colorCanvas, #lightnessSlider {
                width: 60px;
                height: 60px;
            }
            #colorInputs input {
                width: 80px;
            }
            #toolOptions {
                flex-wrap: wrap;
            }
            #filenameInput {
                width: 120px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="header">
            <h1>Doppleit Vector</h1>
            <div id="status">Online</div>
        </div>
        <div id="toolbar">
            <button class="tool-btn active tooltip" data-tool="pen" title="Pen Tool" aria-label="Pen Tool">
                <svg viewBox="0 0 24 24"><path d="M3 17v4h4l14-14-4-4z"/></svg>
                Pen
            </button>
            <button class="tool-btn tooltip" data-tool="shape" title="Shape Tool" aria-label="Shape Tool">
                <svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16"/></svg>
                Shape
            </button>
            <div class="divider"></div>
            <div id="colorPicker">
                <div style="display: flex; gap: 8px;">
                    <canvas id="colorCanvas" width="80" height="80"></canvas>
                    <canvas id="lightnessSlider" width="20" height="80"></canvas>
                </div>
                <div id="colorInputs">
                    <input id="hexInput" placeholder="HEX" aria-label="HEX Color Input">
                    <input id="hslInput" placeholder="HSL" aria-label="HSL Color Input">
                    <input id="rgbInput" placeholder="RGB" aria-label="RGB Color Input">
                </div>
                <div id="swatches"></div>
            </div>
            <div class="divider"></div>
            <div id="toolOptions">
                <h4>Tool Options</h4>
                <label for="strokeWidth">Stroke:</label>
                <input type="range" id="strokeWidth" min="1" max="50" value="5" aria-label="Stroke Width">
                <label for="opacity">Opacity:</label>
                <input type="range" id="opacity" min="0" max="1" step="0.1" value="1" aria-label="Opacity">
                <label for="fill">Fill:</label>
                <input type="checkbox" id="fill" aria-label="Fill Toggle">
                <label for="strokeStyle">Style:</label>
                <select id="strokeStyle" aria-label="Stroke Style">
                    <option value="solid">Solid</option>
                    <option value="dashed">Dashed</option>
                    <option value="dotted">Dotted</option>
                </select>
            </div>
            <div class="divider"></div>
            <div id="exportOptions">
                <input id="filenameInput" placeholder="project-name-date" aria-label="Export Filename">
                <button class="export-btn tooltip" id="exportSvg" title="Export as SVG" aria-label="Export as SVG">
                    <svg viewBox="0 0 24 24"><path d="M19 3H5v18l7-3 7 3V3z"/></svg>
                    SVG
                </button>
                <button class="export-btn tooltip" id="exportPng" title="Export as PNG" aria-label="Export as PNG">
                    <svg viewBox="0 0 24 24"><path d="M19 3H5v18l7-3 7 3V3z"/></svg>
                    PNG
                </button>
                <button class="export-btn tooltip" id="exportJpeg" title="Export as JPEG" aria-label="Export as JPEG">
                    <svg viewBox="0 0 24 24"><path d="M19 3H5v18l7-3 7 3V3z"/></svg>
                    JPEG
                </button>
            </div>
        </div>
        <div id="canvasContainer">
            <canvas id="canvas" width="800" height="600"></canvas>
        </div>
        <div id="footer">
            <a href="#" aria-label="About Doppleit">About</a> |
            <a href="#" aria-label="Support">Support</a> |
            Doppleit Suite v1.0 &copy; 2025
        </div>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const colorCanvas = document.getElementById('colorCanvas');
        const colorCtx = colorCanvas.getContext('2d');
        const lightnessSlider = document.getElementById('lightnessSlider');
        const lightnessCtx = lightnessSlider.getContext('2d');
        const hexInput = document.getElementById('hexInput');
        const hslInput = document.getElementById('hslInput');
        const rgbInput = document.getElementById('rgbInput');
        const swatches = document.getElementById('swatches');
        const strokeWidth = document.getElementById('strokeWidth');
        const opacity = document.getElementById('opacity');
        const fill = document.getElementById('fill');
        const strokeStyle = document.getElementById('strokeStyle');
        const filenameInput = document.getElementById('filenameInput');
        const exportSvg = document.getElementById('exportSvg');
        const exportPng = document.getElementById('exportPng');
        const exportJpeg = document.getElementById('exportJpeg');

        let currentTool = 'pen';
        let drawing = false;
        let paths = [];
        let currentPath = [];
        let currentColor = '#e37800';
        let currentLightness = 50;
        let swatchHistory = JSON.parse(localStorage.getItem('swatches')) || [];

        function updateCursor() {
            canvas.style.cursor = currentTool === 'pen' ? 'crosshair' : 'default';
        }
        updateCursor();

        function drawColorWheel() {
            const width = colorCanvas.width;
            const height = colorCanvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) / 2;

            for (let y = 0; y < height; y++) {
                for (let x = 0; x
const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const colorCanvas = document.getElementById('colorCanvas');
        const colorCtx = colorCanvas.getContext('2d');
        const lightnessSlider = document.getElementById('lightnessSlider');
        const lightnessCtx = lightnessSlider.getContext('2d');
        const hexInput = document.getElementById('hexInput');
        const hslInput = document.getElementById('hslInput');
        const rgbInput = document.getElementById('rgbInput');
        const swatches = document.getElementById('swatches');
        const strokeWidth = document.getElementById('strokeWidth');
        const opacity = document.getElementById('opacity');
        const fill = document.getElementById('fill');
        const strokeStyle = document.getElementById('strokeStyle');
        const filenameInput = document.getElementById('filenameInput');
        const exportSvg = document.getElementById('exportSvg');
        const exportPng = document.getElementById('exportPng');
        const exportJpeg = document.getElementById('exportJpeg');

        let currentTool = 'pen';
        let drawing = false;
        let paths = [];
        let currentPath = [];
        let currentColor = '#e37800';
        let currentLightness = 50;
        let swatchHistory = JSON.parse(localStorage.getItem('swatches')) || [];

        function updateCursor() {
            canvas.style.cursor = currentTool === 'pen' ? 'crosshair' : 'default';
        }
        updateCursor();

        function drawColorWheel() {
            const width = colorCanvas.width;
            const height = colorCanvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) / 2;

            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const dx = x - centerX;
                    const dy = y - centerY;
                    const distanceSquared = dx * dx + dy * dy;

                    if (distanceSquared <= radius * radius) {
                        const angle = Math.atan2(dy, dx);
                        const saturation = Math.sqrt(distanceSquared) / radius;
                        const hue = angle * (180 / Math.PI) + 180;
                        const lightness = currentLightness / 100;
                        colorCtx.fillStyle = `hsl(${hue}, ${saturation * 100}%, ${lightness * 100}%)`;
                        colorCtx.fillRect(x, y, 1, 1);
                    }
                }
            }
        }

        function drawLightnessSlider() {
            const width = lightnessSlider.width;
            const height = lightnessSlider.height;
            const gradient = lightnessCtx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, 'white');
            gradient.addColorStop(0.5, `hsl(0, 0%, ${currentLightness}%)`);
            gradient.addColorStop(1, 'black');
            lightnessCtx.fillStyle = gradient;
            lightnessCtx.fillRect(0, 0, width, height);
        }

        function updateColor(hue, saturation, lightness) {
            currentColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
            hexInput.value = hslToHex(hue, saturation, lightness);
            hslInput.value = `${Math.round(hue)}, ${Math.round(saturation)}%, ${Math.round(lightness)}%`;
            rgbInput.value = hslToRgb(hue, saturation, lightness).join(', ');
            drawLightnessSlider();
        }

        function hexToRgb(hex) {
            const bigint = parseInt(hex.slice(1), 16);
            const r = (bigint >> 16) & 255;
            const g = (bigint >> 8) & 255;
            const b = bigint & 255;
            return [r, g, b];
        }

        function rgbToHsl(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0; // achromatic
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            return [h * 360, s * 100, l * 100];
        }

        function hslToRgb(h, s, l) {
            s /= 100;
            l /= 100;

            let r, g, b;

            if (s === 0) {
                r = g = b = l; // achromatic
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };

                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                h /= 360;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }

            return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
        }

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        function hslToHex(h, s, l) {
            const [r, g, b] = hslToRgb(h, s, l);
            return rgbToHex(r, g, b);
        }

        colorCanvas.addEventListener('mousedown', (e) => {
            const rect = colorCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            const radius = Math.min(rect.width, rect.height) / 2;
            const dx = x - centerX;
            const dy = y - centerY;
            const distanceSquared = dx * dx + dy * dy;

            if (distanceSquared <= radius * radius) {
                const angle = Math.atan2(dy, dx);
                const saturation = Math.sqrt(distanceSquared) / radius * 100;
                const hue = angle * (180 / Math.PI) + 180;
                updateColor(hue, saturation, currentLightness);
            }
        });

        lightnessSlider.addEventListener('mousedown', (e) => {
            const rect = lightnessSlider.getBoundingClientRect();
            let y = e.clientY - rect.top;
            currentLightness = Math.max(0, Math.min(100, (1 - y / rect.height) * 100));
            drawLightnessSlider();
            const [h, s, l] = hslInput.value.split(', ').map(v => parseFloat(v));
            updateColor(h, s, currentLightness);
        });

        hexInput.addEventListener('change', () => {
            const hex = hexInput.value;
            if (/^#([0-9A-F]{3}){1,2}$/i.test(hex)) {
                const [r, g, b] = hexToRgb(hex);
                const [h, s, l] = rgbToHsl(r, g, b);
                currentLightness = l;
                updateColor(h, s, l);
            }
        });

        hslInput.addEventListener('change', () => {
            const hslValues = hslInput.value.split(', ').map(v => parseFloat(v));
            if (hslValues.length === 3 && hslValues.every(v => !isNaN(v))) {
                const [h, s, l] = hslValues;
                currentLightness = l;
                updateColor(h, s, l);
            }
        });

        rgbInput.addEventListener('change', () => {
            const rgbValues = rgbInput.value.split(', ').map(v => parseInt(v));
            if (rgbValues.length === 3 && rgbValues.every(v => !isNaN(v) && v >= 0 && v <= 255)) {
                const [r, g, b] = rgbValues;
                const [h, s, l] = rgbToHsl(r, g, b);
                currentLightness = l;
                updateColor(h, s, l);
            }
        });

        function addSwatch(color) {
            const swatch = document.createElement('div');
            swatch.classList.add('swatch');
            swatch.style.backgroundColor = color;
            swatch.addEventListener('click', () => {
                currentColor = color;
                const [h, s, l] = rgbToHsl(...hexToRgb(color));
                currentLightness = l;
                updateColor(h, s, l);
            });
            swatches.appendChild(swatch);
        }

        function loadSwatches() {
            swatchHistory.forEach(color => addSwatch(color));
        }

        function saveSwatch(color) {
            if (!swatchHistory.includes(color)) {
                swatchHistory.push(color);
                localStorage.setItem('swatches', JSON.stringify(swatchHistory));
                addSwatch(color);
            }
        }

        const colorCanvasContainer = document.querySelector('#colorPicker > div:first-child');
        colorCanvasContainer.addEventListener('dblclick', () => {
            saveSwatch(hexInput.value);
        });

        function handleMouseDown(e) {
            if (currentTool === 'pen') {
                drawing = true;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                currentPath = [{ x, y }];
                paths.push(currentPath);
                draw();
            }
        }

        function handleMouseMove(e) {
            if (!drawing || currentTool !== 'pen') return;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            currentPath.push({ x, y });
            draw();
        }

        function handleMouseUp() {
            drawing = false;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.globalAlpha = opacity.value;
            ctx.lineWidth = strokeWidth.value;
            ctx.strokeStyle = currentColor;

            paths.forEach(path => {
                if (path.length < 2) return;
                ctx.beginPath();
                ctx.moveTo(path[0].x, path[0].y);
                for (let i = 1; i < path.length; i++) {
                    ctx.lineTo(path[i].x, path[i].y);
                }
                ctx.stroke();
            });
        }

        canvas.addEventListener('mousedown', handleMouseDown);
        canvas.addEventListener('mousemove', handleMouseMove);
        canvas.addEventListener('mouseup', handleMouseUp);
        canvas.addEventListener('mouseout', handleMouseUp);

        const toolButtons = document.querySelectorAll('.tool-btn');
        toolButtons.forEach(button => {
            button.addEventListener('click', () => {
                toolButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentTool = button.dataset.tool;
                updateCursor();
            });
        });

        exportSvg.addEventListener('click', () => {
            const svgPaths = paths.map(path => {
                const d = path.map((p, index) => index === 0 ? `M${p.x} ${p.y}` : `L${p.x} ${p.y}`).join(' ');
                return `<path d="${d}" stroke="${currentColor}" stroke-width="${strokeWidth.value}" stroke-linecap="round" stroke-linejoin="round" fill="${fill.checked ? currentColor : 'none'}" stroke-dasharray="${strokeStyle.value === 'dashed' ? '5,5' : strokeStyle.value === 'dotted' ? '2,2' : ''}" opacity="${opacity.value}" />`;
            }).join('');

            const svg = `<svg width="${canvas.width}" height="${canvas.height}">${svgPaths}</svg>`;
            const filename = filenameInput.value || 'vector-export';
            const blob = new Blob([svg], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}.svg`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        exportPng.addEventListener('click', () => {
            const filename = filenameInput.value || 'vector-export';
            const a = document.createElement('a');
            a.href = canvas.toDataURL('image/png');
            a.download = `${filename}.png`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });

        exportJpeg.addEventListener('click', () => {
            const filename = filenameInput.value || 'vector-export';
            const a = document.createElement('a');
            a.href = canvas.toDataURL('image/jpeg');
            a.download = `${filename}.jpeg`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });

        drawColorWheel();
        drawLightnessSlider();
        loadSwatches();
        draw();
    </script>